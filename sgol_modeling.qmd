---
title: "SGOL Forecasting using ARIMA Model and Natural Spline"
author: "Eric L. Dias"
format: pdf
editor: visual
---

## SGOL(abrdn Physical Gold Shares ETF) Modeling

```{r}
library(alphavantager)
```

```{r, echo=FALSE}
av_api_key("JKLTXBLKQ97V149M")
```

```{r, warning=FALSE, }
options(readr.show_col_types = FALSE)
sgol_oct <- av_get(symbol = "SGOL",
                    av_fun = "TIME_SERIES_DAILY",
                    outputsize = "full")

options(readr.show_col_types = FALSE)
sgol_nov <- av_get(symbol = "SGOL",
                   av_fun = "TIME_SERIES_DAILY",
                   outputsize = "full")

sgol_oct <- subset(sgol_oct, timestamp >= as.Date("2025-10-01") &
                     timestamp <= as.Date("2025-10-31"))

sgol_nov <- subset(sgol_nov, timestamp >= as.Date("2025-11-01") &
                     timestamp <= as.Date("2025-11-07"))
```

```{r, warning=FALSE}
library(ggplot2)

ggplot(sgol_oct, aes(x = timestamp, y = close)) +
  geom_line(color = "blue") +
  labs(title = "SGOL Closing Prices October 2025",
       x = "Date", y = "Price (USD)") +
  scale_x_date(date_labels = "%b %d") +  # format x-axis dates nicely
  theme_minimal()
```

```{r, warning=FALSE}
ggplot(sgol_nov, aes(x = timestamp, y = close)) +
  geom_line(color = "darkgreen") +
  labs(title = "SGOL Closing Prices November 2025",
       x = "Date", y = "Price (USD)") +
  scale_x_date(date_labels = "%b %d") +  # format x-axis dates nicely
  theme_minimal()

```

### Augmented Dickey-Fuller Test for Stationarity

```{r}
library(tseries)
oct_ts <- ts(sgol_oct$close)
adf.test(oct_ts)
```

Series Not Stationary

```{r}
oct_diff_ts <- diff(oct_ts)
adf_test = adf.test(oct_diff_ts)
adf_test
```

First Difference Not Stationary

```{r}
oct_secdiff_ts <- diff(oct_diff_ts)
adf_test = adf.test(oct_secdiff_ts)
adf_test
```

Second Difference is Stationary

```{r}
acf(oct_secdiff_ts, main = "ACF of Oct Second Difference")
```

MA Order is 1

```{r}
pacf(oct_secdiff_ts, main = "PACF of Oct Second Difference")
```

AR order is 0

### Fit ARIMA(0, 2, 1) on October Data and Test on November Data

```{r}
library(forecast)
train_series <- c(sgol_oct$close)
model <- Arima(train_series, order = c(0, 2, 1))
predicted <- forecast(model, h=5)$mean
actual <- sgol_nov$close
```

```{r}
cat("Predicted: ", predicted, "\n")
cat("Actual: ", actual)
```

### Plot Predicted and Actual

```{r}
library(ggplot2)
library(tibble)
library(dplyr)

train_dates <- sgol_oct$timestamp
test_dates <- sgol_nov$timestamp

plot_data <- tibble(
  date = c(train_dates, test_dates, test_dates),
  value = c(train_series, predicted, actual),
  type = c(
    rep("Train", length(train_series)),
    rep("Forecast", length(predicted)),
    rep("Actual", length(actual))
  )
)

ggplot(plot_data, aes(x = date, y = value, color = type)) +
  geom_line(size = 1) +
  labs(title = "ARIMA(0, 2, 1) Forecasted vs Actual",
       x = "Date",
       y = "Close Price",
       color = "Series") +
  theme_minimal()
```

### Evaluation of Fit

```{r}
mse <- mean(predicted - actual)^2
cat("MSE: ", mse)
```

```{r}
rss <- sum((predicted - actual)^2)
tss <- sum((actual - mean(actual))^2)
r_squared <- 1 - rss/tss
cat("R Squared: ", r_squared)
```

### Can we use a Natural Spline to get a Better Fit?

I am choosing 16 basis functions based on a visual inspection of the training data.

```{r, warning = FALSE}
library(splines)
x <- 1:length(train_series)
fit <- lm(train_series ~ ns(x, df=16))

x_test <- data.frame(x = (length(train_series) + 1):(length(train_series) + 5))
y_hat <- predict(fit, newdata=x_test, type="response")
```

```{r}
plot_data <- tibble(
  date = c(train_dates, test_dates, test_dates),
  value = c(train_series, y_hat, actual),
  type = c(
    rep("Train", length(train_series)),
    rep("Forecast", length(y_hat)),
    rep("Actual", length(actual))
  )
)

ggplot(plot_data, aes(x = date, y = value, color = type)) +
  geom_line(size = 1) +
  labs(title = "Forecasted(Natural Spline w/16 Basis Functions) vs Actual",
       x = "Date",
       y = "Close Price",
       color = "Series") +
  theme_minimal()
```

### Evaluation of Fit

```{r}
mse <- mean(y_hat - actual)^2
cat("MSE: ", mse)
```

```{r}
rss <- sum((y_hat - actual)^2)
tss <- sum((actual - mean(actual))^2)
r_squared <- 1 - rss/tss
cat("R Squared: ", r_squared)
```

### Conclusion

Using a Natural Spline with 16 degrees of freedom resulted in a much lower Mean Squared Error than using an ARIMA(0, 2, 1) model, meaning it is a better fit. However since both methods resulted in negative R Squared, we are better off simply predicting the mean.
